{% extends "base/base.html" %}

{% block content %}
<div class="profile-page-container">
    <h1>{{ user.username }}'s Profile</h1>
    <p><strong>Name:</strong> {{ user.get_full_name }}</p> <!-- Full name if both first and last are set -->
    
    <h2>Created Rooms</h2>
    {% if recent_rooms %}
        <ul>
            {% for room in recent_rooms %}
                <li>
                    <a class ="profile-tags" style="color: #1A3D31; text-decoration: none;" href="{% url 'post_detail' room.id %}">
                    <h3>{{ room.title }}</h3>
                    </a>
                    <p>{{ room.content }}</p>
                    <small>Created on {{ room.created_at|date:"M d, Y" }}</small>  
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No rooms created yet.</p>
    {% endif %}

    <h2>Recent Activities</h2>
    {% if recent_activities %}
        <div>
        <ul>
            {% for activity in recent_activities %}
                <li>
                    {% if activity.activity_type == "Post" %}
                    <a style="color: #1A3D31; text-decoration: none;" href="{% url 'post_detail' activity.id %}">
                        Post: {{ activity.title }}
                    </a>
                    {% elif activity.activity_type == "Comment" %}
                    <a style="color: #1A3D31; text-decoration: none;" href="{% url 'post_detail' activity.post.id %}">
                        Comment: {{ activity.content }}
                    </a>
                    {% endif %}
                        {{ activity.created_at|date:"M d, Y H:i" }}
                    
                </li>
            {% endfor %}
        </ul>
        </div>
    {% else %}
        <p>No recent activities.</p>
    {% endif %}
        <!-- end posts and activies -->
    <!-- Projects Section -->
    <h2>Completed Projects</h2>
    <button onclick="toggleProjectForm()">+ Add New Project</button>

    <!-- Project Form (Initially Hidden) -->
    <div id="project-form" style="display: none; margin-top: 20px;">
        <form method="POST" action="{% url 'add_project' %}">
            {% csrf_token %}
            <label for="project-name">Project Name:</label>
            <input type="text" id="project-name" name="project_name" required>

            <label for="project-description">Project Description:</label>
            <textarea id="project-description" name="project_description" required></textarea>

            <label for="project-link">GitHub Link:</label>
            <input type="url" id="project-link" name="project_link" required>

            <button type="submit">Submit Project</button>
        </form>
    </div>

    <!-- Display Existing Projects -->
    {% if projects %}
        <ul>
            {% for project in projects %}
                <li>
                    <h3>{{ project.name }}</h3>
                    <p>{{ project.description }}</p>
                    <a href="{{ project.github_link }}" target="_blank">View on GitHub</a>
                    <!-- start delete -->
                    <form action="{% url 'delete_project' project.id %}" method="post" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this project?');">
                            Delete
                        </button>
                    </form>
                    <!-- end delete -->
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No projects added yet.</p>
    {% endif %}

    <!-- start edit/delete profile -->
    <div class="edit-delete">
        <a href="/settings" style="text-decoration: none;">
        <p>✏️ Edit/Delete Profile</p>
        </a>
    </div>
    <!-- added the edit/delete button -->
</div>



<script>
    function toggleProjectForm() {
        const form = document.getElementById('project-form');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }
</script>
{% endblock %}
